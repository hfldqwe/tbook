msg={0:"查询结果为空"}

msg={1:"查询失败"}

"msg":{2:"请求失败"}

# 图书馆爬虫使用说明 #
地址：127.0.0.1
端口：8080(根据实际情况决定)

## 查询馆藏：##
地址：http://127.0.0.1:8080/search?strText=查询字符串&page=1&onlylendable=no
返回示例：
{
    "book_storm":{
        0:["语言","书名","编号","馆藏复本","可借复本","作者","出版社和时间"],
        1:[............],
        2:[............],
        .....
        },
    "cuurent_end_page":"2 / 4",#当前到末尾的页数
    "msg":True
    }
请求方法：GET
参数：
- strText：搜索的关键词
- page：页数，当前页和最后页在查询的时候会给出，所以调用的时候应该根据cuurent_end_page这个参数显示后续的页数，如果查询的参数超出了页数，返回的是最后一页
- onlylendable：是否只查询可借阅的书籍，默认为no，传递任意参数可以让它为yes(包括传递no，不过不建议这么做)

**异常情况**  
1.查询为空：  
- 返回值：{"book_storm": null, "cuurent_end_page": null, "msg": {"0": "查询结果为空"}}  
- 这种情况大多数为用户搜索关键词不存在，但是有少量情况由于图书馆网络问题加载为空，所以碰到这种情况建议重新加载一次，如果还为空则返回查询为空

2.请求失败：
- 返回值：{"book_storm": null, "cuurent_end_page": null, "msg": {"2": "请求失败"}}
- 由于图书馆网络请求等原因，造成无法访问的情况（毕竟学校的服务器经常崩掉）

3.查询失败
- 返回值：{"book_storm": null, "cuurent_end_page": null, "msg": msg={1:"查询失败"}}






## 查询个人借阅情况： ##
http://127.0.0.1:8000/booklst?username=xxxx&password=password
返回示例：
'{
    "info": 
        {"msg": true, 
        "info": {"0": ["编号", "书名/作者", "借阅日期", "到期时间", "续借量", "馆藏地", "附件"], "1": ["2162562", "21天学通Visual C++.第3版 / 张志美等编著", "2018-11-27", "2019-03-04", "0", "逸夫馆信息与控制库", "无"]}}, 
    "renew": {"1": ["2162562", "DDC803E4"]}, 
    "history": {"0": ["条码号", "题名", "责任者", "借阅日期", "归还日期", "馆藏地"], "1": ["1276145", "Visual C++实用教程", "刘惊雷编著", "2018-11-25", "2018-11-27", "逸夫馆信息与控制库"], "2": ["2322829", "计算机系统结构.第4版", "胡亚红, 朱正东, 张天乐编著", "2018-07-18", "2018-10-07", "逸夫馆信息与控制库"], "3": ["1465331", "计算机网络教程", "黄永峰, 李星编著", "2018-07-18", "2018-10-07", "逸夫馆信息与控制库"], "4": ["2440270", "计算机网络安全教程.第3版", "梁亚声 ... [等] 编著", "2018-07-18", "2018-10-07", "逸夫馆信息与控制库"], "5": ["2233062", "深入理解Bootstrap", "徐涛著", "2017-11-13", "2017-12-18", "逸夫馆信息与控制库"], "6": ["2252355", "父与子的编程之旅:与小卡特一起学Python", "(美) Warren Sande, Carter Sande著", "2017-11-05", "2017-12-18", "逸夫馆信息与控制库"], "7": ["2294622", "Python游戏编程入门", "(美) Jonathan S. Harbour著", "2017-11-05", "2017-12-18", "逸夫馆信息与控制库"], "8": ["2294622", "Python游戏编程入门", "(美) Jonathan S. Harbour著", "2017-10-10", "2017-11-05", "逸夫馆信息与控制库"], "9": ["2252355", "父与子的编程之旅:与小卡特一起学Python", "(美) Warren Sande, Carter Sande著", "2017-10-10", "2017-11-05", "逸夫馆信息与控制库"], "10": ["2449100", "Web前端开发技术:HTML、CSS、JavaScript.第2版", "储久良编著", "2017-10-10", "2017-11-05", "逸夫馆信息与控制库"], "11": ["2208774", "数据结构:C++版.第3版", "叶核亚编著", "2017-09-17", "2017-11-05", "逸夫馆信息与控制库"], "12": ["2469142", "21天学通HTML5+CSS3", "宋灵香, 赵静编著", "2017-09-17", "2017-10-19", "逸夫馆信息与控制库"]}, 
    "fine": {"0": ["条码号", "索书号", "题名", "责任者", "借阅日", "应还日", "馆藏地", "应缴", "实缴", "状态"], "1": ["1465331", "TP393/C296", "计算机网络教程", "黄永峰, 李星编著", "2018-07-18", "2018-09-16", "逸夫馆信息与控制库", "1.05", "1.04", "处理完毕"], "2": ["2322829", "TP303/C105=4", "计算机系统结构.第4版", "胡亚红, 朱正东, 张天乐编著", "2018-07-18", "2018-09-16", "逸夫馆信息与控制库", "1.05", "1.03", "处理完毕"], "3": ["2440270", "TP393.08/C414=3", "计算机网络安全教程.第3版", "梁亚声 ... [等] 编著", "2018-07-18", "2018-09-16", "逸夫馆信息与控制库", "1.05", "1.03", "处理完毕"]}}'

~~说明：返回了一个json数据，有两个信息info和renew，info里面有借阅的基本情况，不做过多说明，renew里面的参数是续借时需要使用的~~

修正：现在为四个信息info，renew，history以及fine，分别是当前借阅情况，续借参数，历史借阅以及罚款

参数：
- iPlanetDirectoryPro：cookies中需要的参数，cookies中只有两个参数是必要的，其他的可以不用传过来
- PHPSESSID：另一个cookies里面的参数

**异常情况：**  
返回数据为空：正常的返回值，只是没有数据
- 这种情况有部分可能是由于图书馆网络请求的问题，也算一个之后更改的地方吧

网络请求错误：{"msg":{2:"请求失败"}}
- 这种情况一般由于图书馆网络问题造成

查询出现错误：{"msg":{1:"查询失败"}}
- 这种情况一般不会出现




## 续借： ##
http://127.0.0.1:8000/booklst

{
"bar_code":"xxx",  
"check":"xxx",  
"captcha":"xxx",  
"username":"xxx",  
"username":"xxx"，  
}

请求方法：POST  

说明：首先需要携带cookies访问网址（前端直接使用ajax加载这个图片就可以）：http://wiscom.chd.edu.cn:8080/reader/captcha.php获取用户输入的验证码captcha

参数：
- bar_code：包含在查询个人借阅的返回信息中  
- check：包含在查询个人借阅的返回信息中  
- captcha：这个由用户填写  
- captcha$iPlanetDirectoryPro：一个cookies参数，同上  
- PHPSESSID：一个cookies参数，同上  

返回值：  

<font color=red>不到续借时间，不得续借！</font>

错误的验证码(wrong check code)

没有测试成功的情况，所以不是很清楚


